<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page</title>
    <style>
        body{
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAABUFBMVEX////h4+jNztMpM0z0TCT67mLQztHL09nof2/1Rxrc3uP3inn0RRb4k4LO0tbk5uvgoJj+pzT1PQDr7fDk09TTyMn0QQ4dKUW0t7/5sKQTIkD4+PqCh5QLHDwWJELnw8HklInZ19lhY1H/9mMAMU4AFzrlzc7tlYn0VjSvQjcAHkvqSyb+oRgbMk3hylcAFDj3hXDh1Fz+1Kf80Mn7xLt2e4gAAC1RWGq/wcY/R1wzPFOmqLAAACUAKEb/8uX75FxjTkj/4sX8yEr+qjv801H+yIz/+PD829X2d1/95+P1YUL6urD2bFD5qJvISTW5RDWOQ0N6O0FnPUhTOElKPE7eTzRla3qRlZ+prLbndGLIZlzNQSf3d15xOkOiQDo1NErWn5oAADLhq3Pjqj/kmS/ev6L9vDv/58/+uW3+slj/1679vkT+wHj+ypH+t2H+rknmcdeYAAAJgUlEQVR4nO2da3vTNhSAHTstOKQxtiEOubGsySirQ7pCeoUBbSnQbmzAaOlgbGwMRtvB//82+SrJdzspsjy9H2hjZD/n5ehIsmlljmMwGAwGg8FgMBgMBoPBYPwfefjoJukQzpYLiqgskQ7iDHm8WC+Xy1XxIelAzoqbStlCuUU6lLPhliMIFK+QDuYsQASLqXgTFSxiR32MCwLFx6RDmjJ7YtkL6ZCmy1zdJ1gt1Lz40NtHzX5apNVNQB8FLJIOa3rcCkphoaaMhUDBclkkHdi0uBmcQpDEfdKhTYkfAqvQYIF0aNPBN9kjSSzGXcaP/rnQoTpHOripsBcqWC7GwiaikxZkdXorvJOWy/UiTIlz1QhDsQiLU08ZemcO0uFNAU8ZXl/EHJVd0vFNDDbQiE+E/vAnVLEAMyK6ZBN/7guC0H+KDjX0P81Ah9JnhqAgDJ8XajC9Ag2fDwWL4S/useo10gFOjLtmE585gkYWnVoswLrtWhWtQVfxqa1YvUA6wImxJ3zxJ1QQDDfXLUWxMIaLQwGnv0C7oWp/tQzFp17D4TMRN1RDLpRb2j3rq2X4oi946T/BDNVVYqFmZDS2vpqG6DiKj6eu4eEKZUlsNEct8xvTMCCFIIkvUEOheUgu2iysCs2X5jeGofizP4X2jOEY8h1BIBhueqSRoFmFZRpqzSDuIDkca8KAJxhwag67gjCSjO+AoXjUCOa86Bi2VgRBGxMNOSUboBd2N43vgGF9Xwrmat0xbDTBCU2iIaejNDIKbd34Fhgql6RSID3FMTzQQPsORd10s2sYjozx36hDRBBkDvmwYBu2OkZ7rU047BSsmoNl1xhN56riawn68Ws8dJSWRMtwrWMNr4TDTo46MOPVDjjDsHpNcvwOu51mp9kuOQe+qlqGbc08YVAhHHhi1ppWSrqcYVi/aAtV1rvW4Y2KdUTar1uGG3b7TcKBJ8ZOiTDomYb7ts+qfVjQ1u0jVxXTUB0JMOlUsC7AnMxVlaumj/Sy4y5nmpvWoW8sQyfnZtKpYODkaowaHmiuobCKGR46fzOgZPVdcQyNGREaomvSjnXokmXoutMyI7qdThiYht9YOkgKwYoONdxwDtMy1FjzvT3nQ8N1xHBDRQxbbnuNkjsot6yMCQ4atmEStTGaw9YIHicdezLGI+f+aKUHDUsVN1VCp4YaSitO+wEljzJ4eH+E9NKS1HByNdq0j9g5hO0pGWlU9/ao1EIMS2pDaGqa1tQaagk15EruCZTMFiq8e8AMwXL05fhgvFlyPzuGLrQblqxkwU8FNMQpjOFVZsgMcwczZIb5hxkyw/zDDP/XhhLp2JOhVlySGcL2lBi2B12bt70khuqK075DyVOM8UrH5nYyw9tO+xElhhXeJVkvhe17pGNPhlrCn9PEjzRu++KPpVQaKkeVEEHAeaUAhgu1CMNze8YvXNBteOEyH25Y4S/Tb3ipFmnIX+IoN1TBFBBpyKuUG/KxhmDOpNmQT2BYo9mwl8QQ/XvaDO3lW5wh0oA2Qz6hIU+rIZ/Y0FWky7CXwrAmUWgI76ESGDptqDLkUxna/ZSSpxgqLpjMkKfJsD3orhymNaxtvqXnOU17NDjopTXke+MRNT9PU2s0eD61Ic831mj5eZrSLJ/JkJ+dpeRJlCfu5IY8M8wLfGZDSp6X9iYwrJEOPgklb9RpDHkKfuOi5Qs6lSGf/5WpP+Z0hnyLtEEMviJMbZjzUvQXYWrDfJdiQBGmN8x1KQYGnNowx4vToCLMYpjbUgwswiyGeS3F4CLMZJjTUgyLNothLksxpAgzGuawFMOKMKNh/koxtAizGuauFCNCzWiYs1IML8LshrkqxYgizG6Yp1KMKsIJDHNUitFxZjfMTSlGFuFEhjkpRSkmTMwQ29sk1pAvkZYziClC3FC6uPdaSmGYi1KMDRIzvKYspDLMwWObuCL0GtZTGhIvxdginNSQdCnGF+HEhoRLMUmEkxoSLcUERTgFQ4KlmKQIp2BIrhQTFeE0DImV4rmEwE0hJBUYwk0lJCnpJcgI7h+dT8TSuA35VVxEPrWTXeH8EaFdv5cUMQHVV3c0lzvXxUX046tqkksor8kIAsWoV1e4W82jWwgPgSGyW+vwt9CX7CDUCb4iIpEiujurx1AYLsafT/bFpUtK3Yv3hR3YRt4+w+ueJPouV1cI74d90Q8eM75JstdQeI633vNfjvhbryo1L3hScCGfYR/rpuLROc/FSC+8DXqXPWBZEd8MIw2Hb9Dm4utZz8Vy8QM2Pyg4eCf9RYg0FH7H/0E818rJmxMeRYyonp28h29ePMF3vu6/Cj9Zyc3LL8IVfTt5D/uezcvd90AECP5IWgzyCJs0qpC6EMuwip2ATBM5EuS4KyhfQS52Yg07f6AnIJfJ8Tt2SnCs59BNSwMxtm6Hk0OO/qsiisqsS6syijEc8FwLts/F5BAPahibRJBCyg1r0Uk0XhdAuSG3GplEY2d62g35QYTgYI2j39Degj48hRQaSj0Xw3AtPImdNfME2J6S2QLbvYWDG5j72TDb07d7y/hbm85b03AtbGFjp1C9fcc5gxJD9c+/bpi8+9v6L4ewJG7YJ/Te3fjO4MY7Sn47jzt9Pz8DmJePrc+N4CR2Gnb7Xf2u0X7mrk4s5JQ8eG8GPK/ftw9Ep5DjbMMdagz/tQxn9A/2gcAkuikEhjtm+63PZOJNz7Fud7rvnSOCNhxqKOAj8s6V7S3zhPf/kIg2Cx+sXod0usbqvXtfo9y7tw5TCArXNJT/JRBsNnQzJ+8/wiO7unx3HnJXhvkFLOtWzu/7rpRXPslmwMvwyPfAcAYCDD9w6N+Cf5L5E52e1x8fg4hBwEiagOEObojmkNuWjWOfvnScEwAytiOjI+NutOGyvj2zTVEnBTOiLst4wLjhjuzpkaC9vP1FQ5wQkDL5I3ZEl7cQwy3ZM7kv6zJVKeS4+7onSZ/lE8TwRJY9J3zUT79cdFPhgScjn2QZMdz2ZBhknaZhJpAHMjpdyDJtGYvnGB1qwECzHH8KZXzQkUI8oW1YSYSOFKLsnSwKwUfZ7aY7skzNfVIKwIy37Y6kFN1FJAesTO0kghRi6+7CADIn21Xom++LAeim8sk8uOeQi9lJrbWqvDMP+qjnxqI4nBrdc8v4g/oVWgjGWGNSzHHG4NQ2pOaRWmp2rSQWcT3jcGwoFnDRjXCqF3eYsfmsU/U0JgO72wUuQgaDwWAwGAwGg8FgMBgMRgT/AQcVX78h7hpBAAAAAElFTkSuQmCC);
           background-size: 55%;
            background-repeat: no-repeat ;
        }
        .line {
            
            margin-top: 8px;
            margin-left: 24.4%;
            overflow: hidden;
        }
        .seat {
            margin: 2px;
            float: left;
            width: 30px;
            height: 30px;
            border-radius: 3px;
            
        }
        .enable {
            background-color: gray;
        }
        .enable:hover{
            background-color: lightgray;
        }
        .disable {
            background-color: red;
        }
    </style>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
</head>
<body>
</body>
<script>
    const socket = io.connect();
    socket.on("reserve", (data) => {
        let $target = $("div[data-x ="+data.x+"][data-y ="+data.y+"]");
        $target.removeClass("enable");
        $target.addClass("disable");
    });

    $(window).ready(function(){
        const onClickSeat = function(){
            if($(this).hasClass("disable")){
                return;
            }
            let x = $(this).attr("data-x");
            let y = $(this).attr("data-y");
            if (confirm("이 좌석을 예매 하시나요?")){
                socket.emit("reserve",{
                    x, y
                });
            } else {
                alert("취소 되었습니다.");
            };
        };
        $.getJSON('/seats', {dummy : new Date().getTime()}, (data) => {

            $.each(data, (indexY, line) => {

                let $line = $("<div></div>").addClass("line");

                $.each(line, (indexX, seat) => {
                    `
                    <div class="line">
                        <div class="seats" data-x="indexX" data-y="indexY"></div>
                    </div>
                    `
                    let $output = $("<div></div>", {
                        class : "seat",
                        "data-x" : indexX,
                        "data-y" : indexY,
                    }).appendTo($line);
                    if (seat == 1) {
                        $output.addClass("enable").on("click", onClickSeat);
                    } else if (seat == 2) {
                        $output.addClass("disable");
                    }
                });
                $line.appendTo("body");
            });
        });
    });
</script>
</html>